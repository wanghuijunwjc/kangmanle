<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="css/gouwuche.css">
	</head>
	<body>
		<header>
			<div>
				<img src="img/1.jpg">
				<a href="">收藏康满乐</a>
				<ul>
					<li id="yonghu">您好！ 欢迎光临本店！<a href="login.html">[登录]</a> <a href="zhuce.html">[会员注册]</a></li>
					<li>|</li>
					<li><a href="dingdan.html">我的订单</a></li>
					<li>|</li>
					<li  id="fuwu">客户服务<span> &or;</span>
						<ol>
							<li><a href="">售后服务</a></li>					
							<li><a href="">在线服务</a></li>					
							<li><a href="">联系我们</a></li>
							<li><a href="">投诉中心</a></li>
						</ol>
					</li>
					
					<li>|</li>
					<li id="daohang">网站导航 <span>&or;</span>
						<ol>
							<div>
								<li><strong>特色栏目</strong></li>
								<li><a href="">Vip直通车</a></li>
								<li><a href="">三折区</a></li>
								<li><a href="">折扣区</a></li>
								<li><a href="">平价区</a></li>
								<li><a href="">行业资讯</a></li>
							</div>
							<div>
								<li><strong>特色产品</strong></li>
								<li><a href="">搜乐洗衣液</a></li>
								<li><a href="">搜乐卫生巾</a></li>
								<li><a href="">折搜乐洗手液</a></li>
							</div>
						</ol>
					</li>
					<li class="hy"><a><img src="img/2.jpg" style="width: 14px;">会员中心 <span>&or;</span></a>
						<div id="huiyuan">
							<div>您好，<a href="login.html">请登录，</a> <a href="zhuce.html">会员注册</a></div>
							<div>
								<div id="zuo">
									<p><a href="">待处理订单</a></p>
									<p><a href="">咨询回复</a></p>
								</div>
								<div id="you">
									<p><a href="">我的订单</a></p>
									<p><a href="">我的关注</a></p>
									<p><a href="">我的积分</a></p>
								</div>
							</div>
							<div>
								最近浏览的商品：
							</div>
						</div>
					</li>
					<li id="shuliang"><a href="cart.html">购物车有0件商品，总价格为￥0元</a></li>
				</ul>
			</div>
		</header>
		<!--************logo***********-->
		<div id="logo">
			<img src="img/3.jpg">
			<div>
				<input type="text">
				<input type="button" value="搜索" style="color: #fff;">
				<a href="">搜乐洗衣液</a>
				<a href="">搜乐卫生巾</a>
				<a href="">欧卡姿面膜</a>
			</div>
			<img src="img/4.jpg">
		</div>
		<!--***********nav***************-->
		<nav>
			<ul>
				<li class="xiala"><a href="">全部商品分类</a>
					<ol>
						<li>
							<h4><a href="">Vip直通车</a></h4>
							<a href="">会员套餐</a>
							<a href="">搜乐套餐</a>
						</li>
						<li>
							<h4><a href="">康满乐三折区</a></h4>
							<a href="">日常护理</a>
							<a href="">功能保健</a>
							<a href="">女性特护</a>
							<a href="">健康食品</a>
							<a href="">品味生活</a>
						</li>
						<li>
							<h4><a href="">康满乐折扣区</a></h4>
							<a href="">日常护理</a>
							<a href="">健康养生</a>
							<a href="">功能保健</a>
							<a href="">品味生活</a>
						</li>
						<li>
							<h4><a href="">康满乐平价区</a></h4>
							<a href="">个护化妆</a>
							<a href="">服装鞋帽</a>
							<a href="">家具电器</a>
							<a href="">饮食特产</a>
							<a href="">皮具箱包</a>
							<a href="">养生保健</a>
						</li>
					</ol>
				</li>
				<li><a href="index.html">首页</a></li>
				<li><a href="">VIP直通车</a></li>
				<li><a href="">三折区</a></li>
				<li><a href="">折扣区</a></li>
				<li><a href="">平价区</a></li>
				<li><a href="">众筹专区</a></li>
				<li><a href="">行业资讯</a></li>
				<li><a href="">收费标准</a></li>
			</ul>
		</nav>
		<aside>
			<div id="cart">
					<h3>我的购物车</h3>
					<img src="img/jindu.jpg">
					<div>
						<div id="name">
							<span>商品名称</span>
							<ul>
								<li>属性</li>
								<li>市场价</li>
								<li>本地价</li>
								<li>购买数量</li>
								<li>小计</li>
								<li>操作</li>
							</ul>
						</div>
						<div id="shuxing"></div>
						<div id="jiesuan">
							<b id="js"></b>
						</div>
						<a href="index.html" id="continue">继续购物</a>
						<a href="" id="suan">结算</a>
					</div>
			</div>
		</aside>
<!--*******************footer*************************-->
		<footer>
			<div>
				<img src="img/footer1.jpg">
				<img src="img/footer2.jpg">
				<img src="img/footer3.jpg">
				<img src="img/footer4.jpg">
			</div>
			<div>
				<ul>
					<li>联系我们</li>
					<li><a href="">联系我们</a></li>
					<li><a href="">网站故障报告</a></li>
					<li><a href="">选购咨询</a></li>
					<li><a href="">投诉与建议</a></li>
				</ul>
				<ul>
					<li>新手上路</li>
					<li><a href="">购物流程</a></li>
					<li><a href="">如何注册</a></li>
					<li><a href="">康满乐介绍</a></li>
					<li><a href="">资费标准</a></li>
				</ul>
				<ul>
					<li>商品管理</li>
					<li><a href="">上架总则</a></li>
					<li><a href="">上架细则</a></li>
					<li><a href="">下架细则</a></li>
				</ul>
				<ul>
					<li>配送与支付</li>
					<li><a href="">货到付款区域</a></li>
					<li><a href="">配送方式说明</a></li>
					<li><a href="">支付方式说明</a></li>
				</ul>
				<ul>
					<li>服务保证</li>
					<li><a href="">退换货原则</a></li>
					<li><a href="">售后服务保证</a></li>
					<li><a href="">产品质量保证</a></li>
					<li><a href="">退换货流程</a></li>
				</ul>
			</div>
			<div>
				<span>Copyright&copy;2017康满乐商城  浙ICP备16026032号-2 </span>
				<a href=""><img src="img/zhan.gif"></a>
			</div>
			<div>
				<a href=""><img src="img/cnnic.png"></a>
				<a href=""><img src="img/hy_124x47.png"></a>
				<a href=""><img src="img/bottom_large_img.png"></a>
			</div>
		</footer>
	</body>
</html>
<script src="js/startMove.js"></script>
<script src="js/ajax.js"></script>
<script src="js/cookie.js"></script>
<script src="js/query.js"></script>
<script>
	var username=getCookie("username");
	var yonghu=document.getElementById("yonghu");
	yonghu.innerHTML="您好，"+username+" 欢迎您回来！<a href=''> 用户中心 </a><a onclick='exit()'> 退出 </a>";//a标签中点击事件onclick，不是href指向

	function exit()
	{
	//删除cookie，innerHTML变为初始状态
		setCookie("username","",-1);
		setCookie("password","",-1);
		yonghu.innerHTML="您好！ 欢迎光临本店！<a href='login.html'>[登录]</a> <a href='zhuce.html'>[会员注册]</a>";
	}
	//加入购物车是存的cookie,全部的cookie，没有id传过来，所以是在整个document找cookie，在去判断以个开头的cookie，这才是加入购物车的商品的cookie
	//定义一个时间函数，定时器，每隔10毫秒就重新获取一下cookie
	function gengxin(){
		var str=document.cookie;
		var arr=str.split("; ");
		var l=arr.length;
		var allNum=0;
		var allPrice=0;
		var shuliang=document.getElementById("shuliang");
		var js=document.getElementById("js");
		for(var i=0;i<l;i++){
			var col=arr[i].split("=");
			//console.log(col);
			if(/^g\d+$/.test(col[0])){
					var o=JSON.parse(decodeURIComponent(col[1]));
					//商品总数量和总价
					if(Number(o.num)>1){
						allNum+=Number(o.num);
						allPrice+=Number(o.price)*o.num;
					}else{
						allNum+=Number(o.num);
						allPrice+=Number(o.price);
					}
				}
			}
		
		shuliang.innerHTML="购物车有"+allNum+"件商品，总计"+allPrice+"元";
		js.innerHTML="￥"+allPrice+"元";
	}
	var timergenxin=setInterval(gengxin,10);
	
	var str=document.cookie;
	//console.log(str);
	var arr=str.split("; ");
	var l=arr.length;
	var allNum=0;
	var allPrice=0;
	var shuliang=document.getElementById("shuliang");
	var shuxing=document.getElementById("shuxing");
	var shuxingzhi=document.createElement("ul");
	shuxing.appendChild(shuxingzhi);
	for(var i=0;i<l;i++){
		var col=arr[i].split("=");
		//console.log(col);
		if(/^g\d+$/.test(col[0])){
			var o=JSON.parse(decodeURIComponent(col[1]));
			//商品总数量和总价
			if(Number(o.num)>1){
				allNum+=Number(o.num);
				allPrice+=Number(o.price)*o.num;
			}else{
				allNum+=Number(o.num);
				allPrice+=Number(o.price);
			}
			
			//属性值的添加
			var li=document.createElement("li");
			li.style.cssText="width:1184px; height:106px; line-height: 106px; padding:0 12px; border:1px solid #999;"
			shuxingzhi.appendChild(li);
			//获取图片
			var img=document.createElement("img");
			img.src="img/"+o.img;
			img.style.cssText="float:left; width:70px; height:70px; border:1px solid gray; margin-top:16px;";
			li.appendChild(img);
			//商品名称
			var span=document.createElement("span");
			span.innerHTML=o.title;
			span.style.cssText="display:inline-block; width:477px; font-size:12px;"
			li.appendChild(span);
			//原价
			var span=document.createElement("span");
			span.innerHTML="￥"+o.yuanjia+"元";
			span.style.cssText="margin-right:54px; display: inline-block; width:90px; font-size:10px;"
			li.appendChild(span);
			//本店价
			var span=document.createElement("span");
			span.innerHTML="￥"+o.price+"元";
			span.style.cssText="margin-right:53px; display: inline-block; width:90px;font-size:10px;"
			li.appendChild(span);
			//数量减
			var img1=document.createElement("img");
			img1.goods=o;//存下goods的属性
			img1.src="img/jianhao.jpg";
			li.appendChild(img1);
			//数量框
			var input=document.createElement("input");
			input.style.cssText="width:37px;height:20px; border:1px solid gray;"
			li.appendChild(input);
			//数量加
			var img2=document.createElement("img");
			img2.src="img/jiahao.jpg";
			img2.goods=o//每次都存下img2的goods的属性
			img2.style.cssText="margin-right:64px;";
			li.appendChild(img2);
			//加减号的操作，使输入框数字变
			var n=Number(o.num);
			input.value=n;
			//  小计
			var span=document.createElement("span");
			span.style.cssText="margin-right: 48px; width:77px; display: inline-block;font-size:10px;"
			li.appendChild(span);
			span.innerHTML="￥"+(o.price*n)+"元";
			
			//减号
			img1.onclick=function(){
				var n=this.nextSibling.value;
				n--;
				if(n<=1){
					n=1;
					this.nextSibling.value=1;
				}
				this.nextSibling.value=n;
				//console.log(n);
				var o=this.goods//在之前的存的goods的属性
				o.num=n;
				this.nextSibling.nextSibling.nextSibling.innerHTML="￥"+o.price*n+"元";
				setCookie("g"+o.id,JSON.stringify(o),10);//更细cookie，o.id!!!!!
			}
			//加号
			img2.onclick=function(){
				var n=this.previousSibling.value;
				n++;
				this.previousSibling.value=n;
				var o=this.goods
				o.num=n;
				//console.log(n);
				this.nextSibling.innerHTML="￥"+o.price*n+"元";
				setCookie("g"+o.id,JSON.stringify(o),10);//更细cookie，o.id!!!!!
			}
			var span=document.createElement("span");
			span.innerHTML="删除";
			span.style.cssText="font-size: 12px;"
			span.goods=o//注意存储，点击事件注意存储！！！！！
			li.appendChild(span);
			span.onclick=function()
			{
				var o=this.goods;//存储cookie返回
				setCookie("g"+o.id,"",-1);//删除这个产品
				var r=confirm("您确定将此产品从购物车移除吗？");
				if(r==true)
				{
					this.parentNode.parentNode.removeChild(this.parentNode);
				}
			}
			//删除加入收藏夹
			var a=document.createElement("a");
			a.innerHTML="加入收藏夹";
			a.href="#";
			a.style.cssText="font-size: 12px;"
			li.appendChild(a);
		}
	}
	//结算部分
			var jiesuan=document.getElementById("jiesuan");
			var img=document.createElement("img");
			img.src="img/qinkong.jpg";
			jiesuan.appendChild(img);
			var span=document.createElement("span");
			span.innerHTML="清空购物车";
			span.goods=o;//存下
			jiesuan.appendChild(span);
			
			
			span.onclick=function(){
				var str=document.cookie;
				var s=this.parentNode.previousElementSibling.children[0];
				shuxing.removeChild(s);
				var arr=str.split("; ");
				var l=arr.length;
				for(var i=0;i<l;i++){
					var col=arr[i].split("=");
					//console.log(col);
					if(/^g\d+$/.test(col[0])){
						var o=JSON.parse(decodeURIComponent(col[1]));
						setCookie("g"+o.id,"",-1);
					}
				}
			}
			
			var span=document.createElement("span");
			span.innerHTML="总计（不含运费）：";
			span.style.cssText="float:right;"
			jiesuan.appendChild(span);		
</script>